{
	"info": {
		"_postman_id": "urbagistory-auth-collection",
		"name": "UrbaGIStory API - Authentication",
		"description": "Authentication endpoints for UrbaGIStory\n\n## Setup Instructions:\n1. Import this collection into Postman\n2. Create an environment with the following variables:\n   - `baseUrl`: http://localhost:5064\n   - `token`: (leave empty, will be set automatically after login)\n3. Run the \"Login\" request to get your JWT token\n4. The token will be automatically saved and can be used in other collections",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    var jsonData = pm.response.json();",
							"    if (jsonData.token) {",
							"        pm.environment.set(\"token\", jsonData.token);",
							"        console.log(\"Token saved successfully\");",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"username\": \"testadmin\",\n  \"password\": \"TestPassword123!\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/Auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"Auth",
						"login"
					]
				},
				"description": "Authenticates a user and returns a JWT token. The token will be automatically saved to the environment variable `token` and can be used in other collections."
			},
			"response": []
		},
		{
			"name": "Get Current User",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has user information\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('id');",
							"    pm.expect(jsonData).to.have.property('username');",
							"    pm.expect(jsonData).to.have.property('email');",
							"    pm.expect(jsonData).to.have.property('roles');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/api/Auth/me",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"Auth",
						"me"
					]
				},
				"description": "Gets the current authenticated user information. Requires a valid JWT token in the Authorization header."
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-set Authorization header for authenticated requests",
					"if (pm.request.auth && pm.request.auth.type === 'bearer') {",
					"    var token = pm.environment.get('token');",
					"    if (token && pm.request.auth.bearer) {",
					"        // Ensure bearer array exists and has at least one element",
					"        if (!pm.request.auth.bearer[0]) {",
					"            pm.request.auth.bearer[0] = { key: 'token', value: '', type: 'string' };",
					"        }",
					"        // Only set if current value is empty or is the placeholder",
					"        if (!pm.request.auth.bearer[0].value || pm.request.auth.bearer[0].value === '{{token}}') {",
					"            pm.request.auth.bearer[0].value = token;",
					"        }",
					"    }",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:5064",
			"type": "string"
		},
		{
			"key": "token",
			"value": "",
			"type": "string"
		}
	]
}

